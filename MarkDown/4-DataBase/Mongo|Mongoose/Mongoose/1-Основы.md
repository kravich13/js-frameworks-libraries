# Основы работы с Mongoose, подробное определение схемы

## Подключение и создание

Для подключения пакета `Mongoose` в `package.json` вводим в терминале: 

```bash
npm i mongoose
```

### ***Подключение к БД и создание схемы:***
Подключение к БД и создание схемы, по которой будет строиться коллекция:

```javascript
const mongoose = require("mongoose")
const Schema = mongoose.Schema  


// 1) установка схемы
const userScheme = new Schema({ 
    name: String,
    age: Number
}, { versionKey: false }) // удаление поля "__v" по дефолту


// 2) Подключение к БД
mongoose.connect("mongodb://localhost:27017/nodeTest", { useUnifiedTopology: true })
```

1. Создание схемы, которая описывает данные коллекции. **Вторым** параметром в виде объекта можно указать уже **существующую** коллекцию.
2. Подключение к БД с помощью `connect()`.

### ***Определение модели и добавление данных:***

```javascript
// 1) создание модели пользователя
const UserTest1 = mongoose.model("UserTest1", userScheme)
// 2) создание объекта из этой модели
const userTest1 = new UserTest1({
    name: "Vlad",
    age: 23
})

// 3) сохранение текущего объекта в базу данных
userTest1.save()
.then(function (doc) {
        console.log(`Сохранён объект: ${doc}`)
        mongoose.disconnect()
})
.catch(function (err) {
    console.log(err)
    mongoose.disconnect()
})
```

1. Создание модели с двумя параметрами указывающие **на**:
    * название модели, которая в БД будет иметь множественное число по правилам Англ. языка. Если такая коллекция есть - с ней идёт взаимодействие, если **нет** - она будет создана.
    * схему `userScheme`, по которой будут добавляться данные.
2. Создание документа с полями данных, которые соответствуют схеме `userTest1`.
3. Сохранение переданного объекта `userTest1` в базу данных `nodeTest`.

* Метод `mongoose.disconnect()` производит отключение от БД.

### ***Результат добавления:***

При успешном подключении к БД, определении схемы и добавления документа схемы в БД выведется следующая примерная надпись в консоли:

```bash
(Use `node --trace-deprecation ...` to show where the warning was created)
Сохранён объект: { _id: 5fc754760ab9422fb92ae60b, name: 'Vlad', age: 23 }
```

Добавленная коллекция в БД и добавленный в неё новый документ по схеме: 

```javascript
> show collections
usertest1

> db.usertest1.find()
{ "_id" : ObjectId("5fc753b698ba6a2e76cd7973"), "name" : "Vlad", "age" : 23, "__v" : 0 }
```


По дефолту у каждого документа будет создано поле `__v: 0`, которое описывает версию при добавлении и которую можно изменить. Для полного отключения поля в определении схемы, нужно **вторым** параметром передать объект `{ versionKey: false }`.

Результат `{ versionKey: false }`:

```javascript
> db.usertest1.find()
{ "_id" : ObjectId("5fc754760ab9422fb92ae60b"), "name" : "Vlad", "age" : 23 }
```

* Если забыли убрать `versionKey` с самого начала, то нужно удалить коллекцию, убрать `versionKey` и создать коллекцию заново.
***

## Подробное определение схемы

### ***Определение типа:***

В качестве типа данных можно указать одно из следующих значений:

* `String`
* `Number`
* `Date`
* `Buffer`
* `Boolean`
* `Mixed`
* `Objectid`
* `Array`
* `Decimal128`
* `Map`
* `Schema`

Если свойство представляет сложный объект - в качестве типа указывается определение этого объекта:

```javascript
const userScheme = new Schema({
    name: String,
    age: Number,
    company: {
        name: String,
        employee: [String],
        date: Date
    },
})
```

Больше инфы: <a href>https://mongoosejs.com/docs/schematypes.html</a>

### ***Типы схем:***

Типы схем - это определенные параметры полей. Для возможности указания схем в `key` нужно указывать объект, где `type: String` и `схема: значение`:

```javascript
const userScheme = new Schema({
    name: {
        type: String
    },
    age: {
        type: Number,
        default: 18
    },
    company: {
        name: String,
        employee: [String],
        date: Date
    },
})
```

* `default` - значение по дефолту.
* `required` - обязательное наличие значения для свойства.
* `unique` - уникальное значение для свойства.
* `min` | `max` - задают мин. и макс. значение для типа `Number`.
* `minlength` | `maxlength` - задают мин. и макс. длину для `String`.
* `enum` - строка должна представлять одно из значений в указанном массиве строк.
* `match` - строка должна соответствовать регулярному выражению.

Больше инфы: <a href>https://mongoosejs.com/docs/schematypes.html#schematype-options</a>


