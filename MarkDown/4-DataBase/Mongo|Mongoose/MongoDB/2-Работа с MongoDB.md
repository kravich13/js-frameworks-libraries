# Администрирование, добавление, выборка

## Администрирование

Зарезервированные имена для БД: `local`, `admin`, `config`.

Для просмотра текущей выбранной БД используется команда `db`.

Для просмотра статистики по БД используется `db.stats()`:

```json
{
    "db" : "usersMessages",
    "collections" : 1,
    "views" : 0,
    "objects" : 1,
    "avgObjSize" : 70,
    "dataSize" : 70,
    "storageSize" : 20480,
    "indexes" : 1,
    "indexSize" : 20480,
    "totalSize" : 40960,
    "scaleFactor" : 1,
    "fsUsedSize" : 19368136704,
    "fsTotalSize" : 51338846208,
    "ok" : 1
}
```

Для просмотра отдельной коллекции юзается `db.vlad.stats()`.
***

## Добавление данных

Имя коллекции **не** должно начинаться с префикса `system`, т.к. он зарезервирован для внутренних коллекций. Также имя **не** должно содержать знак `$`.

Для добавления в коллекцию используется три метода:

* `db.vlad.insertOne()` - добавить один документ.
* `db.vlad.insertMany()` - добавить несколько документов.
* `db.vlad.insert()` - добавить как один, так и несколько документов.
* `document` - записать объект или массив объектов и передать параметром в `insert()`.

Пример добавления: 

```json
// для одного документа - просто объект
db.vlad.insertOne({ "message": "супер", "whom": "Max" })


// для нескольких документов - массив из передаваемых объектов
db.vlad.insertMany([
    { "message": "Авентадор?", "whom": "Vlad" },
    { "message": "Ламбо", "whom": "Max" }
])


// логика такая же как выше, только после добавления выводится кол-во добавленных записей
// WriteResult({ "nInserted" : 1 })

document=({"name": "Bill", "age": 32, languages: ["english", "french"]})
db.usvladers.insert(document)

```

Для вывода данных в читабельном виде можно использовать `db.vlad.find().pretty()`:

```json
{
        "_id" : ObjectId("5fbe5a01c3b027decc1718fd"),
        "message" : "Авентадор?",
        "whom" : "Vlad"
}
{
        "_id" : ObjectId("5fbe5a01c3b027decc1718fe"),
        "message" : "Ламбо",
        "whom" : "Max"
}
```

### ***Загрузка данных из файла:***

Данные для MongoDB можно определять в обычном текстовом/js-ном файле и передавать этот файл как цельный объект с помощью метода `load(путь)`.
***

## Выборка данных

Для обычной выборки используется `db.vlad.find({ whom: "Vlad"})`, как было сказано в ***1-Основы***.

Для более сложной выборки (два и более параметра) нужно писать через запятую:

```json
db.vlad.find({ whom: "Vlad", message: "Авентадор?"}).pretty()
```

Выборка по элементу из массива, к примеру если Влад знает `russian`:

```json
db.vlad.find({ languages: "russian" }).pretty()
```

Выборка по массиву, где Влад знает `russian` и `english`:

```json
db.vlad.find({ languages: ["russian", "english"] }).pretty()
```

Выборка по массиву, где `english` самый первый:

```json
db.vlad.find({ "languages.0": "english" }).pretty()

// для второго места - цифра 1 (как индекс массива)
```

### ***Проекция:***

Документ может иметь множество полей. Для выборки определенных полей существуют параметры из объектов, где в данном случае:

1. Ищет по переданному объекту, где `whom: "Max"`.
2. И делает вывод только полей `message`.

```json
db.vlad.find({whom: "Max"}, {message: 1 || "как успехи"}).pretty()


{ "_id" : ObjectId("5fbe2bc1c3b027decc1718f5"), "message" : "Как успехи?" }
all
```

Использование `1` в качестве параметра `{message: 1}` указывает, что запрос должен вернуть только содержание свойства `message`.

Для вывода всех полей документа, **кроме** `message`, нужно указать `{message: 0}`.

Для отключения вывода поля `_id` нужно установить ему значение `{ "_id": 0 }`:

Альтернативно вместо `1` и `0` можно использовать `true` и `false`:

```json
db.vlad.find({ whom: "Max" }, { message: true, _id: false }).pretty()

{ "message" : "как успехи?" }
{ "message" : "супер" }
{ "message" : "супер" }
{ "message" : "Авентадор" }
{ "message" : "Ламбо" }

db.vlad.find({}, { message: true, _id: false }).pretty()

// покажет абсолютно все сообщения из документа без выборки
```

### ***Использование JavaScript:***

MongoDB предоставляет возможность создавать запросы на языке JS. Запрос, который возвращает те документы, в которых `whom = "Vlad"`:

```javascript
fn = function () {
    return this.whom === "Vlad"
}
db.vlad.find(fn, { _id: false })
```

```json
{ "message" : "Авентадор?", "whom" : "Vlad" }
{ "message" : "Авентадор?", "whom" : "Vlad" }
{ "message" : "тест1?", "whom" : "Vlad" }
{ "message" : "Авентадор?", "whom" : "Vlad" }
```

Можно использовать весь функционал JS при желании, главное делать `return`.

### ***Использование регулярных выражений:***

Для выборки по регулярным выражениям всё так же само: 

```javascript
db.vlad.find({ message: /а\w*/gi })
```

### ***Настройка запросов и сортировка:***




