# Добавление, выборка, обновление и удаление данных из таблиц.

## Добавление данных, INSERT

Для добавления данных в БД используется команда `INSERT`, которая имеет следующий синтакс: 

```sql
INSERT [INTO] nameTable [(Arg1, Arg2)] VALUES (value1, value2)
```

Пример создания таблицы с нуля: 

```sql
# 1) Создание БД 
CREATE DATABASE ProductsDB;

# 2) Выбор этой БД
USE ProductsDB;

# 3) Создание таблицы в этой БД
CREATE TABLE Products
( 
    Id INT PRIMARY KEY AUTO_INCREMENT,
    ProductName VARCHAR(30) NOT NULL,
    Manufacturer VARCHAR(20) NOT NULL,
    ProductCount INT DEFAULT 0,
    Price DECIMAL NOT NULL
);
```

Добавление одной строки в эту таблицу: 

```sql
INSERT Products (ProductName, Manufacturer, ProductCount, Price)
VALUES ("iPhone 11 Pro MAX", "Apple", 3, 30000)
```

Можно пропускать указание столбцов со значением `NULL` или для которых указан `DEFAULT`.

### **Множественное добавление:**

Можно добавить сразу несколько строк одной командой: 

```sql
INSERT Products (ProductName, Manufacturer, ProductCount, Price)
VALUES 
("iPhone 6s Plus", "Apple", 1, 10000),
("iPhone 7 Plus", "Apple", 2, 15000),
("iPhone 10", "Apple", 3, 25000);
```
***

## Выборка данных, SELECT

Возьмем данные из прошлой таблицы и покажем их в консоли: 

```sql
SELECT * FROM Products;

+----+----------------+--------------+--------------+-------+
| Id | ProductName    | Manufacturer | ProductCount | Price |
+----+----------------+--------------+--------------+-------+
|  1 | iPhone 6s Plus | Apple        |            1 | 10000 |
|  2 | iPhone 7 Plus  | Apple        |            2 | 15000 |
|  3 | iPhone 10      | Apple        |            3 | 25000 |
+----+----------------+--------------+--------------+-------+
```

### **Получение нужных столбцов:**
Чтобы получить некоторые данные столбцов - нужно после `SELECT` вписывать имена столбцов через запятую вместо `*`: 

```sql
SELECT ProductName, Price FROM Products;

+----------------+-------+
| ProductName    | Price |
+----------------+-------+
| iPhone 6s Plus | 10000 |
| iPhone 7 Plus  | 15000 |
| iPhone 10      | 25000 |
+----------------+-------+
```

### **Указание любого выражения:**
Необязательно указывать имя столбца, можно указать любое выражение, например, результат арифметической операции:

```sql
SELECT ProductName, Price * ProductCount
FROM Products;

+----------------+----------------------+
| ProductName    | Price * ProductCount |
+----------------+----------------------+
| iPhone 6s Plus |                10000 |
| iPhone 7 Plus  |                30000 |
| iPhone 10      |                75000 |
+----------------+----------------------+
```

Здесь при выборке данных **создаётся** новый столб с таким же именем выражения и в него будут записаны конкретно те данные, которые были указаны при `SELECT`.

### **Указание псевдонима:**
С помощью оператора `AS` можно изменить название выходного столбца или определить его всевдоним: 

```sql
SELECT ProductName, Price * ProductCount AS TotalSum
FROM Products;
```

Второй столб теперь имеет название `TotalSum` указанное после `AS`:

```sql
+----------------+----------+
| ProductName    | TotalSum |
+----------------+----------+
| iPhone 6s Plus |    10000 |
| iPhone 7 Plus  |    30000 |
| iPhone 10      |    75000 |
+----------------+----------+
```
***

## Фильтрация данных, WHERE

Зачастую нужно извлекать не все данные из БД, а лишь те, которые подходят под определенные наши условия. Для фильтрации данных в команде `SELECT` применяется оператор `WHERE`, после которого указывается условие:

```sql
SELECT * FROM Products 
WHERE условие
```

Если условие `true` - то строка попадает в результат. **Условия те же, что и в JS, но без строгих равенств. Т.е. вместо `==` и `===` будет просто `=`.**

Для примера можно выбрать те айфоны, которые стоят меньше или равно 15000: 

```sql
SELECT * FROM Products
WHERE Price <= 15000;

+----+----------------+--------------+--------------+-------+
| Id | ProductName    | Manufacturer | ProductCount | Price |
+----+----------------+--------------+--------------+-------+
|  1 | iPhone 6s Plus | Apple        |            1 | 10000 |
|  2 | iPhone 7 Plus  | Apple        |            2 | 15000 |
+----+----------------+--------------+--------------+-------+
```

### **Сложное составное выражение:**

Критерий фильтрации может быть и более сложным, к примеру, найдем товары, у которых совокупная стоимость больше 25000: 

```sql
SELECT * FROM Products
WHERE Price * ProductCount > 25000;

# Всё верно, 15000 * 2 = 30000 и 25000 * 3 = 75000:
+----+---------------+--------------+--------------+-------+
| Id | ProductName   | Manufacturer | ProductCount | Price |
+----+---------------+--------------+--------------+-------+
|  2 | iPhone 7 Plus | Apple        |            2 | 15000 |
|  3 | iPhone 10     | Apple        |            3 | 25000 |
+----+---------------+--------------+--------------+-------+
```

### **Логические операторы:**

Логические операторы позволяют объединить несколько условий. Есть следующие логические операторы: 

* `AND` - **тоже самое, что `&&` в JS.**

    ```sql
    выражение1 AND выражение2
    ```

* `OR` - **тоже самое, что `||` в JS.**

    ```sql
    выражение1 OR выражение2
    ```

* `NOT` - если выражение `false`, то общее условие `true`.

    ```sql
    NOT выражение
    ```

Применение оператора `NOT` - выбрать все товары, которые не относятся к Apple:

```sql
SELECT * FROM Products
WHERE NOT Manufacturer = "Apple";
```

```sql
+----+--------------+--------------+--------------+-------+
| Id | ProductName  | Manufacturer | ProductCount | Price |
+----+--------------+--------------+--------------+-------+
|  4 | Redmi Note 6 | Xiaomi       |           10 |  5000 |
+----+--------------+--------------+--------------+-------+
```

### **Приоритет операций:**

В одном условии можно объединять несколько логических операций. Но самая приоритетная операция - `NOT`, после - `AND` и наименьший приоритет - `OR`:

```sql
SELECT * FROM Products
WHERE Manufacturer = "Xiaomi" OR NOT Price > 15000 AND ProductCount > 2;
```

Порядок приоритета здесь следующий: 

1. Вычисляется `NOT Price > 15000`, т.е. цена должна быть меньше 15к.
2. Вычисляется выражение `NOT Price > 15000 AND ProductCount > 2`, т.е. цена должна быть меньше 15к и одновременно количество товаров должно быть больше 2-х.
3. Вычисляется `OR` - либо цена меньше 15к и ко-во товаров больше 2-х, либо производитель Xiaomi.

В итоге: 

* цена меньше 15к? - да
* цена меньше 15к и кол-во товаров больше 2-х? - да
* цена меньше 15к и кол-во больше 2х или производитель Xiaomi? - да и да

```SQL
+----+--------------+--------------+--------------+-------+
| Id | ProductName  | Manufacturer | ProductCount | Price |
+----+--------------+--------------+--------------+-------+
|  4 | Redmi Note 6 | Xiaomi       |           10 |  5000 |
+----+--------------+--------------+--------------+-------+
```

### **Переопределение приоритетов:**

С помощью скобок можно переопределить приоритеты операций: 

```sql
SELECT * FROM Products 
WHERE Manufacturer = "Apple" AND (Price <= 15000 OR ProductCount > 1); 
```

Ищем телефон Apple с ценой <= 15к или кол-вом больше 1:

```sql
+----+----------------+--------------+--------------+-------+
| Id | ProductName    | Manufacturer | ProductCount | Price |
+----+----------------+--------------+--------------+-------+
|  1 | iPhone 6s Plus | Apple        |            1 | 10000 |
|  2 | iPhone 7 Plus  | Apple        |            2 | 15000 |
|  3 | iPhone 10      | Apple        |            3 | 25000 |
+----+----------------+--------------+--------------+-------+
# В случае без скобок добавится Xiomi и Samsung (4 и 5 id)
```
***

## Обновление данных, UPDATE

Команда `UPDATE` применяется для обновления уже имеющихся строк. **Работает точно также, как переменные в JS.**

К примеру уменьшим цену всех телефонов на 30%: 

```sql
UPDATE Products
SET Price = Price - (Price / 100 * 30);

+----+----------------+--------------+--------------+-------+
| Id | ProductName    | Manufacturer | ProductCount | Price |
+----+----------------+--------------+--------------+-------+
|  1 | iPhone 6s Plus | Apple        |            1 |  7000 |
|  2 | iPhone 7 Plus  | Apple        |            2 | 10500 |
|  3 | iPhone 10      | Apple        |            3 | 17500 |
|  4 | Redmi Note 6   | Xiaomi       |           10 |  3500 |
|  5 | Galaxy S9      | Samsung      |            2 | 39200 |
|  6 | Galaxy S8      | Samsung      |            1 | 28700 |
+----+----------------+--------------+--------------+-------+
```

### **Изменение данных совместно с WHERE:**

Обновление данных при определенном условии:

```sql
# Если есть строка Samsung - переименовать
UPDATE Products
SET Manufacturer = "Samsung Inc."
WHERE Manufacturer = "Samsung";
```

Обновление сразу нескольких столбцов при условии: 

```sql
# Если есть строка Samsung Inc. - переименовать в Samsung и изменить кол-во
UPDATE Products
SET Manufacturer = "Samsung",
    ProductCount = ProductCount + 3
WHERE Manufacturer = "Samsung Inc.";
```

При обновлении вместо конкретных значений можно использовать `DEFAULT` и `NULL` для установки соответствующего значения по дефолту или `NULL`:

```sql
# Если есть Xiaomi - установить дефолтное значение (0, если его нет)
UPDATE Products
SET ProductCount = DEFAULT
WHERE Manufacturer = "Xiaomi";
```
***

## Удаление данных, DELETE

Команда `DELETE` удаляет данные из БД. К примеру удалим строки с производителем Samsung:

```sql
# Если есть самсунг - delete
DELETE FROM Products
WHERE Manufacturer = "Samsung";
```

Если нужно удалить все строки вне зависимости от условия - условие не указывается: 

```sql
DELETE FROM Products;
```