# Встроенные функции для работы со строками и числами

## Функции для работы со строками

* ### `CONCAT` 
    Объединяет строки, в качестве параметра принимает от двух строк для соединения:

    ```sql
    SELECT CONCAT("Vlad", " ", "Kravich"); # Vlad Kravich
    ```

    Также можно передавать числа и даты - они будут преобразовываться в строки.

* ### `CONCAT_WS`
    Объединяет строки, но в качестве **первого** параметра принимает **разделитель**, который будет их соединять:

    ```sql
    SELECT CONCAT_WS(" ", "Vlad", "Kravich", "Age:", 23); # Vlad Kravich Age: 34
    ```

* ### `LENGTH`
    Возвращает кол-во символов в строке, параметром принимает строку:

    ```sql
    SELECT LENGTH("Vlad Kravich"); # 12 
    ```

* ### `LTRIM` и `RTRIM`
    1. Удаляет все пробелы **в начале** строки, параметром принимает строку.
    2. Удаляет все пробелы **в конце** строки, параметром принимает строку.

    ```sql
    SELECT LTRIM("  Aventador"); 
    SELECT RTRIM("Aventador  "); 
    ```

* ### `LOCATE(find, search [,start])` 
    Возвращает позицию первого вхождения подстроки `find` в строку `search`. Доп. параметр `start` устанавливает позицию в строке `search`, с которой начинается поиск в подстроке `find`. Если подстрока не найдена - возвращается 0:

    ```sql
    SELECT LOCATE ("ad", "Vlad Kravich");    # 3
    SELECT LOCATE ("d", "Vlad Kravich");     # 4
    SELECT LOCATE ("r", "Vlad Kravich", 5);  # 7
    SELECT LOCATE ("def", "Vlad Kravich");   # 0
    ```

* ### `LEFT` и `RIGHT`
    1. Вырезать с **начала** строки определенное кол-во символов. 1-й параметр - строка, 2-й - кол-во символов для вырезки с **начала**.
    2. Вырезать с **конца** строки определенное кол-во символов. 1-й параметр - строка, 2-й - кол-во символов для вырезки с **конца**.

    ```sql
    SELECT LEFT("Aventador", 3);    # Ave
    SELECT RIGHT("Aventador", 3);   # dor 
    ```

* ### `SUBSTRING(str, start [,length])`
    Вырезает из строки `str` подстроку, начиная с позиции `start`. Третий необязательный параметр передаёт кол-во вырезанных символов: 

    ```sql
    SELECT SUBSTRING("iPhone 6s Plus", 8),      # 6s Plus
    (SELECT SUBSTRING("iPhone 6s Plus", 8, 2)); # 6s
    ```

* ### `SUBSTRING_INDEX(str, delimiter, count)`
    Вырезает из `str` подстроку. 

    * `delimiter` -  определяет разделитель внутри строки. 
    * `count` - определяет, до какого вхождения разделителя нужно вырезать подстроку. 
    * Если `count` положительный, то подстрока вырезается с начала, если `count` отрицательный, то с конца строки `str`.

    ```sql
    SELECT SUBSTRING_INDEX("iPhone 6s Plus", " ", 1),    # iPhone
    (SELECT SUBSTRING_INDEX("iPhone 6s Plus", " ", 2)),  # iPhone 6s
    (SELECT SUBSTRING_INDEX("iPhone 6s Plus", " ", -2)); # 6s Plus
    ```

* ### `REPLACE(search, find, replace)`
    Заменяет в строке `find` подстроку из `search` на подстроку `replace`:

    ```sql
    SELECT REPLACE("Vlad Defo", "Defo", "Kravich"); # Vlad Kravich
    ```

* ### `INSERT(str, start, length, insert)`
    Вставляет в `str`, заменяя `length` символов с позиции `start` подстрокой `insert`:

    ```sql
    SELECT INSERT("Vlad Defo", 6, 4, "Kravich"); # Vlad Kravich
    ```

* ### `REVERSE`
    Переворачивает строку наоборот:

    ```sql
    SELECT REVERSE("Aventador"); #  rodatnevA   
    ```s

* ### `LOWER` и `UPPER`
    1. Переводит строку в **нижний** регистр.
    2. Переводит строку в **верхний** регистр.

    ```sql
    SELECT LOWER("Kravich");    # kravich
    SELECT UPPER ("Kravich");   # KRAVICH
    ```

* ### `SPACE`
    Возвращает строку, которая содержит определенное кол-во пробелов. **Применимо в `WHERE`.**

* ### `REPEAT(str, count)` 
    Возвращает строку, которая содержит определенное кол-во **повторов** подстроки `str`.

    ```sql
    SELECT REPEAT("kra", 3); # krakrakra
    ```

* ### `LPAD` и `RPAD` | `(str, length, pad)`
    1. Добавляет **слева** от `str` некоторое кол-во символов, которые определены в `pad`. 
    2. Добавляет **справа** от `str` некоторое кол-во символов, которые определены в `pad`. 

    Кол-во добавляемых символов вычисляется по формуле `length - length(str)`. Если `length` меньше длины `str`, то эта строка усекается до `length` символов.
    
    ```sql
    # Длина строки 12. 13-12 = 1 символ *
    SELECT LPAD("Vlad Kravich", 13, "*"); # *Vlad Kravich

    # Длина строки 12, 9-12 = 3 символа delete
    SELECT RPAD("Vlad Kravich", 9, "*"); # Vlad Krav
    ```

### **Пример в работе с таблицей:**

При извлечении данных применим строковые функции: 

```sql
SELECT UPPER( LEFT(Manufacturer, 2)) AS Abbreviation,
    CONCAT(ProductName, " - ", Manufacturer) AS FullProdName
FROM Products
ORDER BY Abbreviation;

# 1) Вырезаем с левой строки 2 первых символа и переводим их в верхний регистр.
# 2) Объединям строки Модели и Производителя, разделив их " * "
# 3) Делаем сортировку по возрастанию.

+--------------+----------------------+
| Abbreviation | FullProdName         |
+--------------+----------------------+
| AP           | iPhone X - Apple     |
| AP           | iPhone 8 - Apple     |
| AP           | iPhone 7 - Apple     |
| HM           | Nokia 8 - HMD Global |
| HU           | Honor 10 - Huawei    |
| SA           | Galaxy S9 - Samsung  |
| SA           | Galaxy S8 - Samsung  |
+--------------+----------------------+
```
***

## Функции для работы с числами

* ### `ROUND`
    Округляет число. 1-й параметр - число, 2-й - указывает на длину. 

    Если длина представляет: 

    * **положительное** число, то оно указывает, до какой цифры **после** запятой идет округление. 
    * **отрицательное** число, то оно указывает, до какой цифры с **конца** числа до запятой идет округление.

    ```sql
    SELECT ROUND(123.15, 1),    # 123.2
    (SELECT ROUND(123.13, -1)); # 120
    ```

* ### `TRUNCATE`
    Оставляет в дробной части определенное кол-во символов:

    ```sql
    SELECT TRUNCATE(123.133, 2); # 123.13
    ```

* ### `ABS`
    Возвращает абсолютное значение числа:

    ```sql
    SELECT ABS(-130); # 130
    ```

* ### `CEILING` и `FLOOR`
    1. Возвращает **наименьшее** целое число, которое >= текущему значению: 
    2. Возвращает **наибольшее** целое число, которое <= текущему значению:

    ```sql
    SELECT CEILING(-123.45),    # -123
    (SELECT CEILING(123.45));   # 124

    SELECT FLOOR(-123.45),      # -124
    (SELECT FLOOR(123.45));     # 123  
    ```

* ### `POWER`
    Возводит число в определенную степень: 

    ```sql
    SELECT POWER(13, 3); # 2197
    ```

* ### `SQRT`
    Получает квадратный корень числа: 

    ```sql
    SELECT SQRT(9); # 3
    ```

* ### `SIGN`
    Возвращает -1, если число < 0 и возвращает 1, если число > 0. Если число = 0 - возвращает 0:

    ```sql
    SELECT SIGN(-3),    # -1
    (SELECT SIGN(3)),   # 1
    (SELECT SIGN(0));   # 0
    ```

* ### `RAND` 
    Генерирует случайное число с плавающей точкой в диапазоне от 0 до 1:

    ```sql
    SELECT RAND();          # 0.5174381663253886 
    SELECT RAND() * 10;     # 3.014836956760694 
    ```

### **Пример работы с таблицей:**

Округлим произведенные цены товара на кол-во этого товара: 

```sql
SELECT ProductName, ROUND(Price * ProductCount, 2)
FROM Products;

+-------------+--------------------------------+
| ProductName | ROUND(Price * ProductCount, 2) |
+-------------+--------------------------------+
| iPhone X    |                      152000.00 |
| iPhone 8    |                      102000.00 |
| iPhone 7    |                      210000.00 |
| Galaxy S9   |                      112000.00 |
| Galaxy S8   |                       46000.00 |
| Honor 10    |                       52000.00 |
| Nokia 8     |                      228000.00 |
+-------------+--------------------------------+
```



