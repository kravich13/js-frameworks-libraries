- [Встроенные функция даты и времени](#встроенные-функция-даты-и-времени)
  - [Функции для работы с датой и временем](#функции-для-работы-с-датой-и-временем)
    - [**Получение даты и времени:**](#получение-даты-и-времени)
    - [**Парсинг даты и времени:**](#парсинг-даты-и-времени)
    - [**Функция EXTRACT:**](#функция-extract)
    - [**Функции для манипуляции с датами:**](#функции-для-манипуляции-с-датами)
    - [**Форматирование дат и времени:**](#форматирование-дат-и-времени)
    - [**Пример с работой из таблицы:**](#пример-с-работой-из-таблицы)

# Встроенные функция даты и времени

## Функции для работы с датой и временем

### **Получение даты и времени:**

* ### `NOW, SYSDATE, CURRENT_TIMESTAMP`
    Возвращают текущую локальную дату на основне системных часов в виде объекта `datetime`:

    ```sql
    SELECT NOW();               # 2020-11-10 13:19:25
    SELECT SYSDATE();           # 2020-11-10 13:19:25
    SELECT CURRENT_TIMESTAMP(); # 2020-11-10 13:19:25
    ```
    
* ### `CURDATE` и `CURRENT_DATE`
    Возвращают текущую локальную дату в виде объекта `date`:

    ```sql
    SELECT CURDATE();       # 2020-11-10    
    SELECT CURRENT_DATE();  # 2020-11-10   
    ```

* ### `CURTIME` и `CURRENT_TIME`
    Возвращают текущее время в виде объекта `time`:

    ```sql
    SELECT CURTIME();       # 13:25:21  
    SELECT CURRENT_TIME();  # 13:25:21  
    ```

* ### `UTC_DATE` И `UTC_TIME`
    1. Возвращает текущую локальную **дату** относительно `GMT`.
    2. Возвращает текущее локальное **время** относительно `GMT`.

    ```sql
    SELECT UTC_DATE();  # 2020-11-10 
    SELECT UTC_TIME();  # 11:27:03  
    ```

### **Парсинг даты и времени:**

Каждая из следующий функций возвращает: 

*  `DAYOFMONTH(date)` - день месяца в виде **Numb**.
* `DAYOFWEEK(date)` - день недели в виде **Numb**.
* `DAYOFYEAR(date)` - номер для в году.
* `MONTH(date)` - месяц даты.
* `YEAR(date)` - год из даты.
* `QUARTER(date)` - номер квартала года.
* `WEEK(date [,first])` - номер недели года. Необяз. параметр позволяет задать стартовый день недели, если `1` - первый день **понедельник**, иначе **воскресенье**.
* `LAST_DAY(date)` - послединй день месяца в виде даты.
* `DAYNAME(date)` - название дня недели.
* `MONTHNAME(date)` - название текущего месяца.
* `HOUR(time)` - час времени.
* `MINUTE(time)` - минуту времени.
* `SECOND(time)` - секунду времени.

Пример использования и возвращаемого результата: 

```sql
SELECT YEAR( CURDATE() ) AS Year, 
WEEK( CURDATE() ) AS Week,
DAYOFYEAR( CURDATE() ) AS DayOfYear; 

+------+------+-----------+
| Year | Week | DayOfYear |
+------+------+-----------+
| 2020 |   45 |       315 |
+------+------+-----------+
```

### **Функция EXTRACT:**

Извлекает из даты и времени какой-то определенный компонент. Синтаксис:

```sql
SELECT EXTRACT(unit FROM datetime)
```

Значения `datetime` представляет исходную дату и (или) время, а значение `unit` указывает, какой компонент даты или времени будет извлекаться.

Параметр `unit` представляет одно из следующих значений:

* `SECOND`
* `MINUTE`
* `HOUR`
* `DAY`
* `MONTH`
* `YEAR`
* `MINUTE_SECOND` 
* `HOUR_MINUTE` 
* `DAY_HOUR` 
* `YEAR_MONTH` 
* `HOUR_SECOND`  
* `DAY_MINUTE`  
* `DAY_SECOND`  

Примеры вызова функции:

```sql
SELECT EXTRACT(SECOND FROM NOW() ) AS Sec,
    EXTRACT(MINUTE FROM NOW()) AS Min, 
    EXTRACT(HOUR FROM NOW()) AS Hour,
    EXTRACT(DAY FROM NOW()) AS Day, 
    EXTRACT(MONTH FROM NOW()) As Mon,
    EXTRACT(YEAR FROM NOW()) AS Year;

+------+------+------+------+------+------+
| Sec  | Min  | Hour | Day  | Mon  | Year |
+------+------+------+------+------+------+
|    4 |    8 |   14 |   10 |   11 | 2020 |
+------+------+------+------+------+------+


SELECT EXTRACT(MINUTE_SECOND FROM NOW()) As MinSec,
    EXTRACT(HOUR_MINUTE FROM NOW()) AS HourMin,
    EXTRACT(DAY_HOUR FROM NOW()) AS DayHour,
    EXTRACT(YEAR_MONTH FROM NOW()) AS YearMon,
    EXTRACT(HOUR_SECOND FROM NOW()) AS HourSec,
    EXTRACT(DAY_MINUTE FROM NOW()) AS DayMin,
    EXTRACT(DAY_SECOND FROM NOW()) AS DaySec;

+--------+---------+---------+---------+---------+--------+----------+
| MinSec | HourMin | DayHour | YearMon | HourSec | DayMin | DaySec   |
+--------+---------+---------+---------+---------+--------+----------+
|   1032 |    1410 |    1014 |  202011 |  141032 | 101410 | 10141032 |
+--------+---------+---------+---------+---------+--------+----------+
```

### **Функции для манипуляции с датами:**

* ### `DATE_ADD(date, INTERVAL expression unit)` 
    Возвращает объект `DATE` или `DATETIME`, который является результатом сложения `date` с определенным временным интервалом.

    * `INTERVAL` - после интервала указывается число.
    * `expression` - кол-во добавляемых к дате единиц.
    * `unit` - тип единиц (часы, дни и т.д.). Может иметь те же значения, что и `EXTRACT`, т.е. `DAY`, `HOUR` и т.д..

    ```sql
    SELECT DATE_ADD( CURDATE(), INTERVAL 1 DAY);    # 2020-11-11 
    SELECT DATE_ADD( CURDATE(), INTERVAL 3 MONTH);  # 2021-02-10     
    SELECT DATE_ADD( NOW(), INTERVAL 4 HOUR);       # 2020-11-10 19:20:32      
    ```

* ### `DATE_SUB(date, INTERVAL expression unit)`
    Возвращает объект `DATE` или `DATETIME`, который является результатом вычитания из `date` определенного временного интервала:

    ```sql
    SELECT DATE_SUB( CURDATE(), INTERVAL 3 MONTH);  # | 2020-08-10     
    ```

* ### `DATEDIFF(date1, date2)`
    Возвращает разницу в днях между `date1` и `date2`:

    ```sql
    SELECT DATEDIFF( CURDATE(), "2021-02-10 ");     # -92
    SELECT DATEDIFF( CURDATE(), "2020-09-02 ");     # 69
    ```

* ### `TO_DAYS(date)`
    Возвращает кол-во дней с 0-го года:

    ```sql
    SELECT TO_DAYS( CURDATE() );    # 738104 
    ```

* ### `TIME_TO_SEC(time)`
    Возвращает кол-во секунд, прошедших с момента полуночи (00:00):

    ```sql
    SELECT TIME_TO_SEC( UTC_TIME() );   # 48913 
    ```

### **Форматирование дат и времени:**

* ### `DATE` и `TIME`  | `_FORMAT(date, format)`
    1. Возвращает объект **`DATE`** или `DATETIME`, отформатированный с помощью шаблона `format`.
    2. Возвращает объект **`TIME`** или `DATETIME`, отформатированный с помощью шаблона `format`.

    **Обе** функции в качестве **второго** параметра принимают строку или отформатированный шаблон, который показывает, как отформатировать значение. Шаблон принимает следующие значения:

    * **`%m`** - месяц в числовом формате: `01` - `12`.
    * **`%c`** - месяц в числовом формате: `1` - `12`.
    * **`%M`** - название месяца: `January` - `December`.
    * **`%b`** - аббревиатура месяца: `Jan` - `Dec`.
    * **`%d`** - день месяца в числовом формате: `00` - `31`.
    * **`%e`** - день месяца в числовом формате: `0` - `31`.
    * **`%D`** - номер дня месяца с суффиксом: `1st`, `2nd`, `3rd`...
    * **`%y`** - год в виде двух чисел.
    * **`%Y`** - год в виде четырёх чисел.
    * **`%W`** - название дня недели: `Sunday` - `Saturday`.
    * **`%a`** - аббревиатура дня недели: `Sun` - `Say`.
    * **`%H`** - час в формате: `00` - `23`.
    * **`%k`** - час в формате: `0` - `23`.
    * **`%h`** - час в формате: `01` - `12`.
    * **`%l`** - час в формате: `1` - `12`.
    * **`%i`** - минуты в формате: `00` - `59`.
    * **`%r`** - время в 12-и часовом формате: `hh:mm:ss AM` | `PM`.
    * **`%T`** - время в 24-и часовом формате: `hh:mm:ss`.
    * **`%S`** - секунды в формате: `00` - `59`.
    * **`%p`** - `AM` или `PM`.

    Пример использования:

    ```sql
    SELECT DATE_FORMAT("2020-11-10", "%d/%m/%Y");       # 10/11/2020        
    SELECT DATE_FORMAT("2020-11-10", "%d %M %Y");       # 10 November 2020 
    SELECT DATE_FORMAT("2020-11-10 15:59:59", "%r");    #  03:59:59 PM    

    SELECT TIME_FORMAT("2020-11-10 15:59:59", "%H:%i:%S");  # 15:59:59     
    SELECT TIME_FORMAT("15:59:59", "%k:%i"); # 15:59                            
    ```

### **Пример с работой из таблицы:**

Таким образом можно найти заказы, которые были сделаны 13 дней назад: 

```sql
SELECT * FROM Orders
WHERE DATEDIFF( CURDATE(), CreatedAt) = 13;
```
